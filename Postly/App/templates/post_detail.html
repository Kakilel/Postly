{% extends "base.html" %}
{% load static %}

{% block title %}{{ post.title }}{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'detail.css' %}">
<div class="post-container">
  <h1>{{ post.title }}</h1>
  <p class="post-meta">By {{ post.author.username }} on {{ post.created_at|date:"M d, Y H:i" }}</p>
  <p class="post-content">{{ post.content }}</p>
  <hr>

  <p><strong>{{ post.likes.count }}</strong> likes</p>
  <!-- Likes -->
{% if user.is_authenticated %}
  <form method="post" action="{% url 'App:like_post' post.pk %}">
    {% csrf_token %}
    {% if user in post.likes.all %}
      <button type="submit" class="btn unlike">Unlike ({{ post.likes.count }})</button>
    {% else %}
      <button type="submit" class="btn like">Like ({{ post.likes.count }})</button>
    {% endif %}
  </form>
{% else %}
  <p><a href="{% url 'Users:login' %}">Login</a> to like this post.</p>
{% endif %}

  <!-- Edit/Delete if author -->
  {% if user == post.author %}
    <div class="action-buttons">
      <a href="{% url 'App:post_edit' post.pk %}" class="btn edit">Edit</a>
      <a href="{% url 'App:post_delete' post.pk %}" class="btn delete">Delete</a>
    </div>
  {% endif %}

  <hr>
  <h3>Comments</h3>
  {% for comment in post.comments.all %}
    <div class="comment-box">
      <p><strong>{{ comment.author.username }}</strong> said:</p>
      <p>{{ comment.body }}</p>
      <small>{{ comment.created_at|date:"M d, Y H:i" }}</small>
    </div>
  {% empty %}
    <p>No comments yet.</p>
  {% endfor %}

  <!-- Add comment -->
  {% if user.is_authenticated %}
    <h4>Add a Comment</h4>
    <form method="post" action="{% url 'App:add_comment' post.pk %}" class="comment-form">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <button type="submit" class="btn submit">Submit</button>
    </form>
  {% else %}
    <p><a href="{% url 'Users:login' %}">Login</a> to comment.</p>
  {% endif %}
</div>
{% endblock %}
